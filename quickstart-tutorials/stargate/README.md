# Datastax Stargate in action

##### Download Stargate
```
curl -O -L "https://github.com/datastax/stargate/releases/download/v0.1.1/stargate_0.1.1_$(uname -s)_x86_64.tar.gz"
tar -xzf ./stargate_*.tar.gz
```
##### Start Stargate server with Cassandra on Docker
```
./stargate service start --with-cassandra 
```
:tv: Output
```
Pulling image: docker.io/library/cassandra:latest
Starting Cassandra. This might take a minute...
Pulling image: docker.io/datastax/stargate:latest
Starting Stargate...
Success!
```

##### Apply the schema to Stargate server 
More about Stargate Schema Definition here: https://github.com/datastax/stargate/blob/master/docs/schema_definition.md
```
./stargate apply keyspace1 article.conf
```

:tv: Output
```
Endpoint created at http://localhost:8080/v1/api/keyspace1/schema

View your API at: http://localhost:8080/api-docs/keyspace1/swagger/
```

##### Check cassandra table
```
docker exec -it stargate-cassandra cqlsh -e 'USE keyspace1; DESC TABLES;'
```
:tv: Output
```
article
```
##### Insert some data by invoking the API generated by Stargate server
```
curl -X POST 'http://localhost:8080/v1/api/keyspace1/query/entity/article' \
--header 'accept: application/json' \
--header 'Content-Type: application/json' \
--header 'Content-Type: text/plain' \
--data-raw '[
    {
        "id": 1,
        "url": "https://opensource.com/article/20/5/linux-gaming",
        "mimetype": "text/html",
        "is_starred": 1,
        "preview_picture": "none",
        "domain_name": "opensource.com",
        "content": "Test content",
        "title": "4 Linux distributions for gaming",
        "created_at": "2020-05-29 22:55:00",
        "updated_at": "2020-05-29 22:55:00",
        "reading_time": 600,
        "is_public": true,
        "user_name": "john",
        "user_id": 101,
        "user_email": "john.doe@anant.us",
        "content_text": "Test content as text",
        "language": "en",
        "is_archived":0,
        "http_status": "200"
    }
]'
```
:tv: Output similar to next block
```
[
  {
    "entityId": "05bc2f15-a9ad-400b-948e-1169261b25a4"
  }
]
```

##### Check cassandra table content
```
docker exec -it stargate-cassandra cqlsh -e 'EXPAND ON; SELECT * FROM keyspace1.article;'
```
:tv: Output
```
Now Expanded output is enabled

@ Row 1
-----------------+--------------------------------------------------
 entityId        | 05bc2f15-a9ad-400b-948e-1169261b25a4
 content         | Test content
 content_text    | Test content as text
 created_at      | 2020-05-29 22:55:00
 domain_name     | opensource.com
 http_status     | 200
 id              | 1
 is_archived     | 0
 is_public       | True
 is_starred      | 1
 language        | en
 mimetype        | text/html
 preview_picture | none
 reading_time    | 600
 title           | 4 Linux distributions for gaming
 updated_at      | 2020-05-29 22:55:00
 url             | https://opensource.com/article/20/5/linux-gaming
 user_email      | john.doe@anant.us
 user_id         | 101
 user_name       | john

(1 rows)
```

##### Stargate API calls can also be made using Swagger UI
<img src="https://github.com/Anant/cassandra.toolkit/blob/master/stargate/stargate-swagger.png"
     alt="stargate-swagger"
     style="float: left; margin-right: 10px;" />
